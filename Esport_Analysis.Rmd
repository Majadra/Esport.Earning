---
title: "Esport_Analysis"
author: "Ran K"
date: "7/28/2020"
output: 
  html_document:
    number_sections: true
    toc: true
    fig_width: 7
    fig_height: 4.5
    theme: cosmo
    highlight: tango
    code_folding: hide
  
---

```{r setup, include = FALSE}
library(tidyverse)
library(ggrepel)
library(scales)
library(gridExtra)
library(forcats)
library(ggrepel)

detach("package:tidyverse", unload = TRUE)

# magic option
options(tidyverse.quiet = TRUE)
library(tidyverse)

knitr::opts_chunk$set(warning = FALSE)
theme_set(theme_bw())

```

# Introduction

According to [Wikipedia](https://en.wikipedia.org/wiki/Esports) - <br>
Esports (also known as electronic sports, e-sports, or eSports) is a form of sport competition using video games. Esports often takes the form of organized, multiplayer video game competitions, particularly between professional players, individually or as teams.

* **In the notebook** I will try to shine some light on this growing industy by doing an **Exploratory data analysis** or **EDA**, ill create some charts, some plots in the hopes of learning something new.

* **This dataset** comes entirely from [EsportsEarnings.com](https://www.esportsearnings.com), this site gets its information by different contributers. As the data is collected by volunteers, it is likely that there would be some errors in documentation (I would assume these errors are more frequent in smaller tournaments and in tournaments that happened in the early 2000's, when the Esports scene was a lot smaller). This means that we should take all the earnings data with a grain of salt and not as a definitive number. <br>




<br>

## Loading data

```{r Load Data}
HistData <- read.csv("HistoricalEsportData.csv")
GenData <- read.csv("GeneralEsportData.csv")

#Quick variable summary.
str(HistData)
str(GenData)
```

## Some variable formatting

```{r Variable_manipulation_Year}
# I would like to change the "Year" variable into date format
options(scipen = 100)

HistData$Date <- as.Date(HistData$Date, format = "%m/%d/%Y")

# Adding timely variables to facilitate plotting
HistData$Year <- as.numeric(regmatches(HistData$Date,regexpr("^\\d{4}",HistData$Date)))
HistData$Month <- as.numeric(regmatches(HistData$Date,regexpr("\\d{2}(?=-01$)",HistData$Date, perl = TRUE)))
```

```{r Variable_manipulation_Genre}
# Making the genre variable easier to work with
GenData$Genre <- gsub(" Game","",GenData$Genre)
GenData$Genre[which(GenData$Genre == "Multiplayer Online Battle Arena")] <- "MOBA"
GenData$Genre[which(GenData$Genre == "Role-Playing")] <- "RPG"
GenData$Genre[which(GenData$Genre == "Third-Person Shooter")] <- "TPS"
GenData$Genre[which(GenData$Genre == "First-Person Shooter")] <- "FPS"
```


## Removing games who "do not belong" in this database.
<br>
I have came to the conclusion that not every game that is presented on the site should be in this database: <br>
Games without any recorded cash prizes or an amount which is extremely low (for example, the fighting game **King of Fighters XI which has a whopping total of 25$ in prize pool distributed), the same goes for the number of tournaments, a game which held only one or two tournaments does not qualify here (in my opinion). <br>

For this reason I have decided to ommit from the database games who has either **less then 500$ prize pool earnings** and 
game with **less then 5 tournaments and a total prize pool of under 2000$** recorded on the site. 

```{r filtering the data}
Games_to_filter <- GenData$Game[which(GenData$TotalEarnings < 500 | (GenData$TotalTournaments < 5 & GenData$TotalEarnings <2000))]

GenData <- GenData[-which(GenData$Game %in% Games_to_filter),]
HistData <- HistData[-which(HistData$Game %in% Games_to_filter),]

rm(Games_to_filter) # No longer necessary
```
<br>
We are now ready to start our analysis.

#  Explanatory Data Analysis
<br>
First of all, let's look at which games had the biggest amount of money distributed. <br>

## Biggest Games (Earning wise)
```{r Biggest_TotalEarnings}
# Adding a rank for the earnings per game

GenData[order(GenData$TotalEarnings, decreasing = TRUE),] %>%
  slice(1:10) %>%
  ggplot(data = .,aes(x = reorder(Game,+ TotalEarnings), y = TotalEarnings)) + 
  geom_bar(stat = "identity", 
           fill = rainbow(n = 10 , start = 0.35, end = 0.45), color = "black", alpha = 0.85) + 
  coord_flip() +
  labs(x = element_blank(), y = "Earnings in millions") +
  scale_y_continuous(labels = scales::label_number(scale = 1/10^6)) +
  geom_text(aes(label = round(TotalEarnings/(10^6),0), hjust = 1.2))
```

<br>
In the top 10 biggest games, there are no apparent surprises, we find **Dota 2**, **CS:GO**,**Fortnite**,**League of Legends**, and **Starcraft 2** at the top. <br>
Let's see the evolution of prizes destributed in these top 5 games. <br> 

```{r Biggest_TotalEarnings_timeline}
# Preparing list of top 5 games
Top5Games <- c(GenData[order(-GenData$TotalEarnings),1] %>% head(5))

# Prepering Data for the plot
Top5GamesTimeline <- HistData[which(HistData$Game %in% Top5Games),c(1:3,5)]
Top5GamesTimeline$Game[which(Top5GamesTimeline$Game == "Counter-Strike: Global Offensive")] <- "CS : GO"
Top5GamesTimeline$Game[which(Top5GamesTimeline$Game == "League of Legends")] <- "LOL"
Top5GamesTimeline$Game <- factor(Top5GamesTimeline$Game,levels = c("Dota 2","CS : GO","Fortnite","LOL","StarCraft II"))

ggplot(data = Top5GamesTimeline, aes(x = Date, y = Earnings/1000)) +
  geom_area(fill = "lightblue",color = "black") +
  facet_grid(Game ~ .,scales = "free") +
  labs(title = "Prize pool evolution - top 5 games",subtitle = "In thousands",x = element_blank(), y = element_blank()) +
  scale_x_date(breaks = "2 years", date_labels = "%Y")

rm(Top5Games,Top5GamesTimeline) # No longer necessary

```

We can see that some games distribute prize money in a cyclical manner, with one main tournament every year (like **Dota** and **LOL**). other games like **StarCraft** and **CS : GO** seems to distribute prize pool in a more even manner. For **Fortnite** it is too early to say as the game came out at 2018.


```{r Game_earnings_pieplot}
# Reordering based on earnings
GenData <- GenData[order(GenData$TotalEarnings,decreasing = T),]

# Calculating the precenetage of earnings from total earnings
Top10Earnings <- 
  data.frame(Title = c(GenData$Game[1:10],"Other"), 
  Percent = c(GenData$TotalEarnings[1:10]/sum(GenData$TotalEarnings),
  1 - sum(GenData$TotalEarnings[1:10])/sum(GenData$TotalEarnings)), Position = 1:11)
Top10Earnings$Title <- factor(Top10Earnings$Title,levels = Top10Earnings$Title)

# Plotting
ggplot(data = Top10Earnings,aes(x = "",y = Percent,fill = Title)) +
  geom_bar(width = 1,stat = "identity",color = "black") +
  theme(legend.position = "right", legend.title = element_text(face = "bold"),
        axis.text = element_text(face = "bold")) +
  coord_polar("y",direction = -1) +
  theme_minimal() +
  labs(title = "Precentage of earnings", y = element_blank(), x = element_blank(),
       fill = "Game Title") 

rm(Top10Earnings) # No longer necessary
```
<br>
We can see that the earnings are highly concentrated: almost 50% of the earnings are concentrated in 3 games and about 75% of the total earnings come from the biggest 10 games.


Now let's see which games had the most tournaments <br>





## Biggest Games (Tournament wise)

```{r Most_tournaments}
# Plotting
GenData[order(GenData$TotalTournaments, decreasing = TRUE),] %>%
  slice(1:10) %>%
  ggplot(data = .,aes(x = reorder(Game,+ TotalTournaments), y = TotalTournaments)) + 
  geom_bar(stat = "identity", fill = rainbow(n = 10 , start = 0.35, end = 0.45)
           , color = "black", alpha = 0.85) + 
  coord_flip() +
  labs(title = "Games with the most tournaments",x = element_blank(), y = element_blank()) +
  geom_text(aes(label = TotalTournaments), hjust = 1.2)

```
<br>

It is not surprising that we find a similarity between the two lists: Dota 2, Starcraft 2, League of Legends and Counter-Strike: Global Offensive are all in the top 10 in prizepool earnings. <br>
What is somewhat interaesting is the fact that we have 3 different Super Smash Bros games, all in the top 10, this is while being not as big in the matter of prize pools (1.2M, 1.5M and 3.1M). <br>



```{r Biggest_Tournaments_timeline}
# Preparing list of top 5 games
Top5Games <- c(GenData[order(-GenData$TotalTournaments),1] %>% head(5))

# Prepering Data for the plot
Top5GamesTimeline <- HistData[which(HistData$Game %in% Top5Games),c(1:3,5)]
Top5GamesTimeline$Game[which(Top5GamesTimeline$Game == "Counter-Strike: Global Offensive")] <- "CS : GO"
Top5GamesTimeline$Game[which(Top5GamesTimeline$Game == "League of Legends")] <- "LOL"
Top5GamesTimeline$Game[which(Top5GamesTimeline$Game == "Super Smash Bros. Melee")] <- "Sm.Melee"
Top5GamesTimeline$Game <- factor(Top5GamesTimeline$Game,levels = c("StarCraft II","Sm.Melee","CS : GO","LOL","Dota 2"))

ggplot(data = Top5GamesTimeline, aes(x = Date, y = Tournaments)) +
  geom_area(fill = "lightblue",color = "black") +
  facet_grid(Game ~ .,scales = "free") +
  labs(title = "Tournament evolution - top 5 games",x = element_blank(), y = element_blank()) +
  scale_x_date(breaks = "2 years", date_labels = "%Y")

rm(Top5Games,Top5GamesTimeline) # No longer necessary

```
<br>
The distribution of **Dota** and **LOL** tournaments seems cyclical, also, it is interesting how there where **Super Smash Bros.Melee** tournamnets back in 2003 but the amount picked up only around 2014.
<br>


```{r Tournaments_pieplot}
# Reordering based on tounaments
GenData <- GenData[order(GenData$TotalTournaments,decreasing = T),]

# Calculating the precenetage of earnings from total earnings
Top10Tournaments <- 
  data.frame(Title = c(GenData$Game[1:10],"Other"), 
  Percent = c(GenData$TotalTournaments[1:10]/sum(GenData$TotalTournaments),
  1 - sum(GenData$TotalTournaments[1:10])/sum(GenData$TotalTournaments)), Position = 1:11)
Top10Tournaments$Title <- factor(Top10Tournaments$Title,levels = Top10Tournaments$Title)

# Plotting
ggplot(data = Top10Tournaments,aes(x = "",y = Percent,fill = Title)) +
  geom_bar(width = 1,stat = "identity",color = "black") +
  theme(legend.position = "right", legend.title = element_text(face = "bold"),
        axis.text = element_text(face = "bold")) +
  coord_polar("y",direction = -1) +
  theme_minimal() +
  labs(title = "Precentage of tournaments", y = element_blank(), x = element_blank(),
       fill = "Game Title") 

rm(Top10Tournaments) # No longer necessary
```
<br>
Indeed, tournaments are a little bit less concetrated then earnings.
<br>

Let's take a deeper look at the data - <br>
First, let's look at how the earnings developped through the years.

## Yearly prise earnings.

```{r Yearly_earnings}
# Plotting Earnings per year
ggplot(data = HistData %>%
         group_by(Year) %>%
         summarise(EarningsInMillions = round(sum(Earnings)/1000000,1)),
       aes(x = Year, y = EarningsInMillions)) +
  geom_bar(stat = "Identity", fill = "lightblue",color = "black") +
  geom_text(aes(label = EarningsInMillions),
            vjust = -0.3,hjust = 0.5, size = 3.2) +
  theme_classic() +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank()) + 
  labs(title = "Earnings per year", subtitle = "In millions of dollars",
       y = element_blank(),x = element_blank())

```
<br>
__It is important to note that 2020 is not finished and this is why the earnings are low.__
We can see that the Esports industry picked up towards 2011 - 2012, reaching a whopping 228.9 miliion dollar in prizes distributed in 2019. <br>
Also it is interesting to note that was a small dip earnings in 2009, probably caused by the 2008 - 2009 economic crisis.

## Yearly amount of tournaments

```{r Yearly_tournaments}

# Plotting Tournaments per year
ggplot(data = HistData %>%
         group_by(Year) %>%
         summarise(TotalEarnings = sum(Earnings), Tournaments = sum(Tournaments)),
       aes(x = Year, y = Tournaments, group = 1)) +
  geom_bar(stat = "identity", fill = "lightblue",color = "black") +
  geom_text(aes(label = Tournaments), vjust = - 0.5, size = 3) +
  labs(title = "Tournaments per year", y = element_blank(),x = element_blank()) +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())
```

<br>
Tournament wise, we see that the number of tournaments started to skyrocket in 2011, stabilizing at the 4500 - 5500 range from 2015 onwards. <br> 


Now let's look at the monthly data: is there a specific period with more tournaments and more prize earnings? 
__(for these plots I will filter out all datapoints from 2020, as it is not over yet).__ <br>

## Monthly prizepool earnings and tournaments

```{r Earnings_Per_month}
# For the purpose of this plot ill transform the month variable into a factor
HistData$Month <- as.factor(HistData$Month)
# Plotting

p1 <- ggplot(data = HistData %>% 
         filter(Date < "2020-01-01") %>%
         group_by(Month) %>%
         summarise(Earnings_in_millions = round(sum(Earnings)/10^6,1)),
         aes(x = Month, y = Earnings_in_millions)) +
  geom_bar(stat = "identity",fill = "lightblue",color = "black") +
  theme(legend.position = "bottom") +
  geom_text(aes(label = Earnings_in_millions), vjust = -0.3,hjust = 0.55, size = 3) +
  labs(title = "Esport monthly earnings", subtitle = "In millions of dollars", y = element_blank()) +
  theme_classic() +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())

p2 <- ggplot(data = HistData %>%
         filter(Date < "2020-01-01") %>%
         group_by(Month) %>%
         summarise(Tournaments = sum(Tournaments)), aes(x = Month, y = Tournaments,fill = Month)) +
  geom_bar(stat = "identity", color = "black") +
  theme_classic() +
  theme(legend.position='none') +
  labs(title = "Number of tournaments", y = element_blank())

grid.arrange(p1,p2,ncol = 2)
rm(list = c("p1","p2"))
```

We can see that most of the earnings came from the months of july and august, and as we see that the number of tournements isn't especially higher in these months, it is safe to say that the avarage prizepool is higher in these times (which makes since, as the summer is a peak periode in the Esports industry).

## Covid 19 affect on the Esports industry

To check this, ill creat a line plot of months with each line representing a year from 2016 onwards, if the coronavirus had no affect, we should see that 2020 looks to be similar to other years in the matter of tournaments, and higher than other years earning wise.

```{r Coronavirus_effect_earnings}
HistData$Year <- as.factor(HistData$Year)

# Filtering to last 5 years and plotting monthly earnings
ggplot(data = HistData %>% 
         filter(Date >= "2016-01-01") %>% 
         group_by(Year,Month) %>% 
         summarise(Earnings = round(sum(Earnings)/1000000,2)),
       aes(x = Month, y = Earnings, group = Year)) +
  geom_line(aes(color = Year), size = 1) +
  theme_minimal() +
  labs(title = "Monthly earnings 2016 - 2020",
       subtitle = "In millions of dollars",x = element_blank(), y = element_blank())

```

We can see that 2020 did not open well as expected, as of march we see a decrease in earnings when compared to prior years, between 30% to 60%, depending on the month.
The effect of the pandemic could be felt most in the summer months, let's see a detailed look at the summer months <br>

```{r Coronavirus_effect_earnings_summer}
# Filtering to last 5 years and plotting monthly earnings
ggplot(data = HistData %>% 
         filter((Month == 7 | Month == 8) ,Date >= "2010-01-01") %>% 
         group_by(Year) %>% 
         summarise(Earnings = round(sum(Earnings)/1000000,2)),
       aes(x = Year, y = Earnings,fill = Earnings)) +
  geom_bar(stat = "identity", color = "black") +
  scale_fill_gradient(low ="lightsalmon",high = "green2") +
  labs(title = "Yearly prize pool during july - august",
       subtitle = "In millions of dollars",x = element_blank(), y = element_blank()) +
  guides(fill = "none") + 
  theme_classic() +
  geom_text(aes(label = Earnings, vjust = -0.25))

```
<br>
In the summer of 2020 the prizepool allocated in Esport tournements was **5 times** lower then in 2019.

Let's look at the tournament plot now.

```{r Coronavirus_effect_tournaments}
# Filtering to last 5 years and plotting monthly amount of tournaments

ggplot(data = HistData %>% 
         filter(Date >= "2016-01-01") %>% 
         group_by(Date) %>% 
         summarise(Tournaments = sum(Tournaments)),
       aes(x = Date, y = Tournaments)) + 
  geom_area(fill = "lightblue", alpha = 0.85) +
  geom_line(color = "black") +
  labs(title = "Monthly amount of tournaments 2016 - 2020",
       subtitle = "11 of march 2020 - official date of the coronavirus being declared a pandemic",x = element_blank(), y = element_blank()) +
  scale_x_date(labels = date_format("%m/%y"),breaks = seq.Date(from = as.Date("2016-01-01"), to = as.Date("2021-01-01"), by ="6 months")) +
  geom_vline(xintercept = as.Date("2020-03-11"), linetype = "dashed", color = "darkred",size = 1)

```

It seems that tournements have been hit hard as well: after a usual weak start (as january and fabruary are the months with the lowest amounts of tournaments) the the number of tournaments did not rise as sharply as in recent years. <br>


Let's look at the diffrenet genres <br>

## A look at Genres

``` {r Total_earnings_per_genre}
# Preparing Data
Genre_plot <- GenData %>% 
  filter(Genre != "Puzzle") %>%
         group_by(Genre) %>% 
         summarise(Total_M = round(sum(TotalEarnings)/10^6,1),
                   Average_M = round(mean(TotalEarnings)/1000000,1),
                   Number = n())
# Plotting total earnings per genre
ggplot(data = Genre_plot,
       aes(x = reorder(Genre,-Total_M),y = Total_M, fill = reorder(Genre,-Total_M))) +
  geom_bar(stat = "identity",alpha = 0.75,color = "black") +
  geom_text(aes(label = Total_M),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right",plot.subtitle = element_text(size = 10)) + 
  labs(title = "Total prizepool earnings by genre",
       subtitle = "in millions of dollars \n(not including the puzzle genre)",
       y = element_blank(),
       x = element_blank(),
       fill = "Genre")






```





``` {r Number_of_games_per_genre}
# Plotting average earnings per genre

ggplot(data = Genre_plot,
       aes(x = reorder(Genre,-Total_M),y = Number, fill = reorder(Genre,-Total_M))) +
  geom_bar(stat = "identity",alpha = 0.75,color = "black") +
  geom_text(aes(label = Number),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right",plot.subtitle = element_text(size = 10)) + 
  labs(title = "Average prizepool earnings by genre",
       subtitle = "in millions of dollars \n(not including the puzzle genre)",
       y = element_blank(),
       x = element_blank(),
       fill = "Genre")


```





``` {r Average_earnings_per_genre}

# Plotting average earnings per genre

ggplot(data = Genre_plot,
       aes(x = reorder(Genre,-Total_M),y = Average_M, fill = reorder(Genre,-Total_M))) +
  geom_bar(stat = "identity",alpha = 0.75,color = "black") +
  geom_text(aes(label = Average_M),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right",plot.subtitle = element_text(size = 10)) + 
  labs(title = "Average prizepool earnings by genre",
       subtitle = "in millions of dollars \n(not including the puzzle genre)",
       y = element_blank(),
       x = element_blank(),
       fill = "Genre")

```




 <br><br>
 We can see that there is no real relation between the number of games and the amount of money distributed in Esport tournaments. <br>
 
Now let's look at the release date, do games from a specific year had a biggest impact on the Esports industry?
 
``` {r ReleaseDate_histogram}
rm(Genre_plot) # Not necessary anymore

# Plotting
ggplot(data = GenData %>% mutate(Temp = ifelse(ReleaseDate == 2007,TRUE,FALSE)), aes(x = ReleaseDate,fill = Temp)) + 
  geom_histogram(color = "tomato2",alpha = 0.45,size = 1,binwidth = 1) +
  labs(title = "Distribution of release dates", y = element_blank(), x = element_blank()) +
  scale_x_continuous(breaks = c(seq(from = 1990, to = 2200, by = 10),2007)) +
  scale_fill_manual(values = c("tomato1","tomato4")) +
  guides(fill = "none")

```  
<br>
It is intersting to note that there was a after 2007 there was a sharp decrease in the amount of releases - I would suspect that it is due to the 2008 financial crisis.  
<br>

``` {r Avg_earnings_per_releasedate}
# Plotting
ggplot(data = GenData, aes(x = ReleaseDate,y = TotalEarnings,color = Genre,size = TotalEarnings)) +
  geom_point() +
  ggrepel::geom_text_repel(data = head(GenData[order(-GenData$TotalEarnings),],5),
               aes(label = Game), size = 3.5,
               box.padding = unit(0.45, "lines"),
               point.padding = unit(0.3, "lines")) +
  guides(size = "none") +
  scale_y_continuous(labels = scales::label_number(scale = 1/1000000)) +
  scale_x_continuous(breaks = seq(from = 1980, to = 2020, by = 5)) +
  labs(title = "Earnings by release date",subtitle = "In millions of dollars",
    y = element_blank(), x = element_blank())
```  
<br>
We can see that there is no real correlation between the release date of the game and the success it will have in the Esports scene.<br>

Now let's have a look at **OnlineEarnings**

## Precentage of prizes from online tournaments

```{r OnlineEarning}
GenData$PercentOnline <- GenData$OnlineEarnings/GenData$TotalEarnings

ggplot(GenData, aes(x = reorder(Genre,-PercentOnline), y = PercentOnline)) + geom_boxplot() +coord_flip()
ggplot(GenData %>% 
         filter(TotalEarnings >10000), aes(x = reorder(Genre,-PercentOnline), y = PercentOnline)) + geom_boxplot() +coord_flip()




```









Now it's time to dive in and do a little bit of feature engineering the retrieve some precius insight.

# Feature engineering

In this part i'd like to create new variables which will help in the analysis process.

<h3>Creating **Franchise** variable</h3><br>
As a lot of the games are a part of a franchise containing several games, it may help us if we look at the date looking at the entire franchise, for example, let's take a look at the **Street - Fighter** franchise.<br>

```{r Street_Fighter_look,echo = TRUE}
# Creating a dataframe with games with a name containing the name "Street Fighter"
df_sf <- GenData[which(grepl("[Ss]treet [Ff]ighter",GenData$Game) == TRUE),]
df_sf
print(paste0("The number of games is ",nrow(df_sf)," and the total earnings for the franchise is ",sum(df_sf$Earnings)))

# Removing the df as it is unnecessary
rm(df_sf)

```
<br>
Ok, so the fact that a game is a part of a franchise **_does_** matter. In the case if the "Street Fighter" franchise, there are 15 games with earnings ranging from 350 to 220,000 dollars.<br>
It is fair to say that the entire franchise had destruted prizes in an amount of almost 560,000 dollars.<br>

To figure out which games are a part of which franchise, ill work with the __Earnings_per_game__ dataframe (as it has 1 observation per game, it is easier to work with) and use some regular expressions to find game titles which have identical words in it.

```{r franchise_search_5_words}

# At the start ill cast a large net, finding the first 5 words of each game.
# then filtering to find groups of 2 or more games with the same 5 first words in the title.

temp_5_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",GenData$Game)
# Creating a dataframe to recieve the matches
temp_5_words <- data.frame(words = regmatches(GenData$Game,temp_5_words))
temp_5_words <-  temp_5_words %>% group_by(words) %>% summarise(n=n())
# Filtering and presnting
temp_5_words <- temp_5_words %>% filter(n >1)
temp_5_words

# We already indentified a few franchises, ill put them in a new variable - "Franchise".

GenData[which(grepl("Call of Duty",GenData$Game) == TRUE),"Franchise"] <- "Call of Duty"
GenData[which(grepl("Guilty Gear",GenData$Game) == TRUE),"Franchise"] <- "Guilty Gear"
GenData[which(grepl("Street Fighter",GenData$Game) == TRUE),"Franchise"] <- "Street Fighter"

# Removing the dataframe unnecessary 
rm(temp_5_words)
```
<br>

Now we move into the 4 words category, but at first we will need to filter out the games with a valid francise variable, ill put all the games that are left in another temporary dataframe - **Franchise_check**. <br>

I'll continue the same process for expressions that inclue 4, 3, 2 and then one word (ill not present it to not clutter too much).

```{r franchise_search_4_words, include = FALSE}

Franchise_check <- GenData %>% filter(is.na(Franchise))
temp_4_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_4_words <- data.frame(words = regmatches(Franchise_check$Game,temp_4_words))
temp_4_words <- temp_4_words %>% group_by(words) %>% summarise(n=n())
temp_4_words <- temp_4_words %>% filter(n >1)
temp_4_words

# Continuing on and inserting more franchises.

GenData[which(grepl("Dead or Alive",GenData$Game) == TRUE),"Franchise"] <- "Dead or Alive"
GenData[which(grepl("Dengeki Bunko",GenData$Game) == TRUE),"Franchise"] <- "Dengeki Bunko"
GenData[which(grepl("Melty Blood",GenData$Game) == TRUE),"Franchise"] <- "Melty Blood"
GenData[which(grepl("Need for Speed",GenData$Game) == TRUE),"Franchise"] <- "Need for Speed"
GenData[which(grepl("Under Night In-Birth",GenData$Game) == TRUE),"Franchise"] <- "Under Night In-Birth"

# Removing the dataframe unnecessary 
rm(temp_4_words)
```


```{r franchise_search_3_words, include = FALSE}

Franchise_check <- GenData %>% filter(is.na(Franchise))
temp_3_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_3_words <- data.frame(words = regmatches(Franchise_check$Game,temp_3_words))
temp_3_words <- temp_3_words %>% group_by(words) %>% summarise(n=n())
temp_3_words <- temp_3_words %>% filter(n >1)
temp_3_words

# Continuing on and inserting more franchises.

GenData[which(grepl("Age of Empires",GenData$Game) == TRUE),"Franchise"] <- "Age of Empires"
GenData[which(grepl("Arcana Heart",GenData$Game) == TRUE),"Franchise"] <- "Arcana Heart"
GenData[which(grepl("BlazBlue",GenData$Game) == TRUE),"Franchise"] <- "BlazBlue"
GenData[which(grepl("Capcom vs. SNK",GenData$Game) == TRUE),"Franchise"] <- "Capcom vs. SNK"
GenData[which(grepl("Gears of War",GenData$Game) == TRUE),"Franchise"] <- "Gears of War"
GenData[which(grepl("King of Fighters",GenData$Game) == TRUE),"Franchise"] <- "King of Fighters"
GenData[which(grepl("Magic: The Gathering",GenData$Game) == TRUE),"Franchise"] <- "Magic: The Gathering"
GenData[which(grepl("Marvel vs. Capcom",GenData$Game) == TRUE),"Franchise"] <- "Marvel vs. Capcom"
GenData[which(grepl("Persona",GenData$Game) == TRUE),"Franchise"] <- "Persona"
GenData[which(grepl("Pro Evolution Soccer",GenData$Game) == TRUE),"Franchise"] <- "Pro Evolution Soccer"
GenData[which(grepl("Project Gotham Racing",GenData$Game) == TRUE),"Franchise"] <- "Project Gotham Racing"
GenData[which(grepl("Rainbow Six",GenData$Game) == TRUE),"Franchise"] <- "Rainbow Six"
GenData[which(grepl("Soul Calibur",GenData$Game) == TRUE),"Franchise"] <- "Soul Calibur"
GenData[which(grepl("Super Smash Bros",GenData$Game) == TRUE),"Franchise"] <- "Super Smash Bros"
GenData[which(grepl("Tekken ",GenData$Game) == TRUE),"Franchise"] <- "Tekken" #Left the space on purpose
GenData[which(grepl("Virtua Fighter",GenData$Game) == TRUE),"Franchise"] <- "Virtua Fighter"
GenData[which(grepl("World of Tanks",GenData$Game) == TRUE),"Franchise"] <- "World of Tanks"

# Removing the dataframe unnecessary 
rm(temp_3_words)
```

```{r franchise_search_2_words, include = FALSE}

Franchise_check <- GenData %>% filter(is.na(Franchise))
temp_2_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_2_words <- data.frame(words = regmatches(Franchise_check$Game,temp_2_words))
temp_2_words <- temp_2_words %>% group_by(words) %>% summarise(n=n())
temp_2_words <- temp_2_words %>% filter(n >1)
temp_2_words

# Continuing on and inserting more franchises.

GenData[which(grepl("Day of Defeat",GenData$Game) == TRUE),"Franchise"] <- "Day of Defeat"
GenData[which(grepl("Dragon Ball",GenData$Game) == TRUE),"Franchise"] <- "Dragon Ball"
GenData[which(grepl("FIFA Online",GenData$Game) == TRUE),"Franchise"] <- "FIFA Online"
GenData[which(grepl("Forza Motorsport",GenData$Game) == TRUE),"Franchise"] <- "Forza"
GenData[which(grepl("Gran Turismo",GenData$Game) == TRUE),"Franchise"] <- "Gran Turismo"
GenData[which(grepl("Guitar Hero",GenData$Game) == TRUE),"Franchise"] <- "Guitar Hero"
GenData[which(grepl("Halo",GenData$Game) == TRUE),"Franchise"] <- "Halo"
GenData[which(grepl("Madden NFL",GenData$Game) == TRUE),"Franchise"] <- "Madden NFL"
GenData[which(grepl("Mortal Kombat",GenData$Game) == TRUE),"Franchise"] <- "Mortal Kombat"
GenData[which(grepl("NASCAR Thunder",GenData$Game) == TRUE),"Franchise"] <- "NASCAR Thunder"
GenData[which(grepl("Pokkén Tournament",GenData$Game) == TRUE),"Franchise"] <- "Pokkén Tournament"
GenData[which(grepl("Project Cars",GenData$Game) == TRUE),"Franchise"] <- "Project Cars"
GenData[which(grepl("Samurai Shodown",GenData$Game) == TRUE),"Franchise"] <- "Samurai Shodown"
GenData[which(grepl("Track[Mm]ania",GenData$Game) == TRUE),"Franchise"] <- "TrackMania"
GenData[which(grepl("Unreal Tournament",GenData$Game) == TRUE),"Franchise"] <- "Unreal Tournament"

# Removing the dataframe unnecessary 
rm(temp_2_words)
```

```{r franchise_search_1_word, include = FALSE}

Franchise_check <- GenData %>% filter(is.na(Franchise))
temp_1_word <- regexpr("^[[:graph:]]+",Franchise_check$Game)
temp_1_word <- data.frame(words = regmatches(Franchise_check$Game,temp_1_word))
temp_1_word <- temp_1_word %>% group_by(words) %>% summarise(n=n())
temp_1_word <- temp_1_word %>% filter(n >1)
temp_1_word

# Continuing on and inserting more franchises.

GenData[which(grepl("Artifact",GenData$Game) == TRUE),"Franchise"] <- "Artifact"
GenData[which(grepl("Asphalt ",GenData$Game) == TRUE),"Franchise"] <- "Asphalt" # Space is on purpose
GenData[which(grepl("Battlefield",GenData$Game) == TRUE),"Franchise"] <- "Battlefield"
GenData[which(grepl("Counter-Strike",GenData$Game) == TRUE),"Franchise"] <- "Counter-Strike"
GenData[which(grepl("Doom",GenData$Game) == TRUE),"Franchise"] <- "Doom"
GenData[which(grepl("Dota 2|Defense of the Ancients",GenData$Game) == TRUE),"Franchise"] <- "Dota"
GenData[which(grepl("F1",GenData$Game) == TRUE),"Franchise"] <- "F1"
GenData[which(grepl("FIFA (?!Online)",GenData$Game,perl = TRUE) == TRUE),"Franchise"] <- "FIFA" # As Fifa and Fifa online are different
GenData[which(grepl("NHL",GenData$Game) == TRUE),"Franchise"] <- "NHL"
GenData[which(grepl("Power Rangers",GenData$Game) == TRUE),"Franchise"] <- "Power Rangers"
GenData[which(grepl("Quake",GenData$Game) == TRUE),"Franchise"] <- "Quake"
GenData[which(grepl("Skullgirls",GenData$Game) == TRUE),"Franchise"] <- "Skullgirls"
GenData[which(grepl("Splatoon",GenData$Game) == TRUE),"Franchise"] <- "Splatoon"
GenData[which(grepl("Supreme Commander",GenData$Game) == TRUE),"Franchise"] <- "Supreme Commander"
GenData[which(grepl("Tetris",GenData$Game) == TRUE),"Franchise"] <- "Tetris"
GenData[which(grepl("^WarCraft",GenData$Game) == TRUE),"Franchise"] <- "WarCraft"
GenData[which(grepl("Wolfenstein",GenData$Game) == TRUE),"Franchise"] <- "Wolfenstein"
GenData[which(grepl("NBA",GenData$Game) == TRUE),"Franchise"] <- "NBA"

# Removing the dataframe unnecessary 
rm(temp_1_word)
```

```{r Last_franchise_check,include = FALSE}
Franchise_check <- GenData %>% filter(is.na(Franchise))

GenData[which(grepl("^Gears ",GenData$Game) == TRUE),"Franchise"] <- "Gears of War"
GenData[which(grepl("^Catherine",GenData$Game) == TRUE),"Franchise"] <- "Catherine"
GenData[which(grepl("(?<!Auto )[Cc]hess",GenData$Game,perl = TRUE) == TRUE),"Franchise"] <- "Chess" #Avoiding Auto Chess
GenData[which(grepl("Injustice",GenData$Game,perl = TRUE) == TRUE),"Franchise"] <- "Injustice"
GenData[which(grepl("PLAYERUNKNOWN",GenData$Game,perl = TRUE) == TRUE),"Franchise"] <- "PUBG"
GenData[which(grepl("StarCraft",GenData$Game,perl = TRUE) == TRUE),"Franchise"] <- "StarCraft"

```

```{r franchise_for_standalone_games, echo = TRUE}
# For the rest of the games which are not part of a franchise ill insert their title as a franchise.
##### A note #######
# It is important that once the database will be updated with more games this process will need to be redone.
####################
for (i in seq(1:nrow(GenData)))
  {
  if (is.na(GenData[i,"Franchise"]))
    {
    GenData[i,"Franchise"] <- GenData[i,"Game"]
  }
}

for (i in 1:nrow(GenData)) {
  GenData[i,"FranchiseSize"] <- length(which(GenData$Franchise == GenData$Franchise[i]))
}

sum(is.na(GenData$Franchise))
# All done!

# Deleating the df
rm(Franchise_check,i)
```

Now let's do some analysis about different franchises in the Esports scene. <br>




First, let's see which if after itroducing franchises, the list of top 10 in distribution of prize money change.

```{r top10_franchise}
# Creating df that groups by franchises
Earnings_by_franchise <- GenData %>% 
  select(TotalEarnings,Genre,TotalTournaments,Franchise,FranchiseSize) %>% 
  group_by(Franchise,Genre) %>% 
  summarise(Size = n(),Tournaments = sum(TotalTournaments),Earnings = sum(TotalEarnings),Size = n())

# Ordering and keeping the 10 biggest franchises
Earnings_by_franchise[order(Earnings_by_franchise$Earnings,decreasing = TRUE),][1:10,]
```

<br>
As there are no real differences between the list of top10 games and top10 franchises (except for the Call of Duty franchise in 6th place with 16 games in the franchise), now lets see how the list of top 10 largest amount of tournaments changes after intoducing franchises.


```{r Largest_amount_of_tournaments}
# Ordering and keeping the 10 biggest franchises
Earnings_by_franchise[order(Earnings_by_franchise$Tournaments,decreasing = TRUE),][1:10,c(1,3,4,5)]
```
<br>
Also in the matter of the amount of tournaments, except the Call of Duty and WarCraft franchises, the list stays about the same.


``` {r Total_franchises_per_genre}
# Creating another df, this time for the plot

Franchise_by_genre <- Earnings_by_franchise %>% 
  group_by(Genre) %>%
  summarise(Number_of_franchises = n(),Tournaments = sum(Tournaments),Earnings = sum(Earnings),Number_of_games = sum(Size),Avg_games_per_franchise = round( (sum(Size)/n()),2))

# Plotting

ggplot(data = Franchise_by_genre,aes(x = Genre,y = Number_of_franchises, fill = Genre)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Number_of_franchises),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right") + 
  labs(title = "Number of franchises per genre", y = element_blank(), x = element_blank())

```

<br>






<h2>This is a work in progress, there is more to come</h2>
<h3>Feel free to upvote or to give feedback :)</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  