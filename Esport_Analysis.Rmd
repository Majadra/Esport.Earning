---
title: "Esport_Analysis"
author: "Ran K"
date: "7/14/2020"
output: html_document
  
---

```{r setup, include = FALSE}
library(tidyverse)
library(ggrepel)
library(scales)
library(gridExtra)
library(forcats)
library(ggrepel)
```

```{r knitr_otions, include = FALSE}
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width=9, fig.height=6)
```

<center><h2>Loading data</center></h2>
<br>

```{r Load Data}
df <- read.csv("EsportsEarnings_final.csv")

#Quick variable summary.
str(df)
```

<center><h2>Some variable manipulation</center></h2>


```{r Variable_manipulation_date,echo = TRUE}
# I would like to change the "Year" and "ReleaseDate" variables into date format

df$Date <- as.Date(df$Date)

#fixing a small error
df[which(df$ReleaseDate==11),"ReleaseDate"] <- 2011 #checked online
df$ReleaseDate <- paste0("01/01/",df$ReleaseDate)
df$ReleaseDate <- as.Date(df$ReleaseDate,format = "%d/%m/%Y")
```

```{r Variable_manipulation_genre,echo = TRUE}
# Creating a dataframe
df$Genre <- gsub(" Game","",df$Genre)
df$Genre[which(df$Genre == "Multiplayer Online Battle Arena")] <- "MOBA"
df$Genre[which(df$Genre == "Role-Playing")] <- "RPG"
df$Genre[which(df$Genre == "Third-Person Shooter")] <- "TPS"
df$Genre[which(df$Genre == "First-Person Shooter")] <- "FPS"
```

<center><h2> Explanatory Data Analysis</h2></center>
<br>

**An important note**, all the information from this dataset comes from [EsportsEarnings](https://www.esportsearnings.com), this site gets its information by different contributers. As the data is collected by volunteers, it is likely that there would be errors in documentation (I would assume these errors are more frequent in smaller tournaments and in tournaments that happened more then 10-15 years ago, when the Esports scene was a lot smaller). This means that we should take all the earnings data with a grain of salt and not as a definitive number. <br>

First of all, let's look at which games had the biggest amount of money distributed.

```{r Biggest_games}
# Creating a dataframe
Earnings_by_game <- df %>%
  group_by(Game,Genre,ReleaseDate) %>%
  summarise(Earnings = sum(Earnings),Tournaments = sum(Tournaments),Players = sum(Players))

# Adding a rank for the earnings per game
Earnings_by_game$Earnings_rank <- as.integer(rank(-Earnings_by_game$Earnings))

# Adding a precent from total variable
Earnings_by_game$Percent_from_total <- Earnings_by_game$Earnings / sum(Earnings_by_game$Earnings)

# Presenting top10
Earnings_by_game[order(Earnings_by_game$Earnings_rank),] %>%
  filter(Earnings_rank <= 10) %>%
  select(Game,Genre,Earnings,Percent_from_total)

# Creating statistical summary of the earnings.
summary(Earnings_by_game$Earnings)

```
<br>
In the top 10 biggest games, there are no apparent surprises, we find **Dota 2**, **CS:GO**,**Fortnite**,**League of Legends**, and **Starcraft 2** at the top. <br>
Also, the data shows that the earnings are extremely right skewed, as the mean is almost 4 times the size of the median.<br>

```{r Game_earnings_pieplot}

# Creating a specific index for the top 10 games
Earnings_by_game$PlotIndex <- if_else(Earnings_by_game$Earnings_rank <= 10,Earnings_by_game$Game,"Other")
# Reordering based on the ranking for changing the order of the levels
Earnings_by_game <- arrange(Earnings_by_game,Earnings_rank)

temp <- c(Earnings_by_game$PlotIndex[1:10],"Other")
Earnings_by_game$PlotIndex <- fct_relevel(Earnings_by_game$PlotIndex,c(temp))
# Plotting
ggplot(Earnings_by_game,aes(x = "",y = Percent_from_total,fill = PlotIndex)) +
  geom_bar(width = 1, stat = "identity",color = "black") +
  theme_minimal() +
  theme(legend.position = "right", legend.title = element_text(face = "bold"),
        axis.text.x=element_blank()) +
  coord_polar("y", start = 0) +
  labs(title = "Total earning per game", y = "From total earnings", x = element_blank(),
       fill = "Game Title") 
```
<br>
We can see that the earnings are highly concentrated: about 75% of the total earnings come from the biggest 10 games.


Now let's see which game had the most tournaments

```{r Most_tournaments}
# Deleating all temporary variables which are now unnecessary
Earnings_by_game <- subset(Earnings_by_game, select = -c(Percent_from_total,PlotIndex))

# Adding a rank for the tournaments per game
Earnings_by_game$Tournament_rank <- as.integer(rank(-Earnings_by_game$Tournaments))

# Adding a precent from total variable
Earnings_by_game$Percent_from_total <- Earnings_by_game$Tournaments / sum(Earnings_by_game$Tournaments)

# Presenting top10
Earnings_by_game[order(Earnings_by_game$Tournament_rank),] %>%
  filter(Tournament_rank <= 10) %>%
  select(Game,Genre,Tournaments,Percent_from_total)
```
<br>

It is not surprising that we find a similarity between the two lists: Dota 2, Starcraft 2, League of Legends and Counter-Strike: Global Offensive are all in the top 10 in prizepool earnings. <br>
What is somewhat interaesting is the fact that we have 3 different Super Smash Bros games, all in the top 10, this is while being not as big in the matter of prize pools (1.2M, 1.5M and 3.1M). <br>
Also, it seems as though the amount of tournaments is concentrated between a few big games, but less then the earnings, let's visualise.


```{r Tournaments_pieplot}

# Creating a specific index for the top 10 games (tournament wise)
Earnings_by_game$PlotIndex <- if_else(Earnings_by_game$Tournament_rank <= 10,Earnings_by_game$Game,"Other")
# Reordering based on the ranking for changing the order of the levels
Earnings_by_game <- arrange(Earnings_by_game,Tournament_rank)

temp <- c(Earnings_by_game$PlotIndex[1:10],"Other")
Earnings_by_game$PlotIndex <- fct_relevel(Earnings_by_game$PlotIndex,c(temp))
# Plotting
ggplot(Earnings_by_game,aes(x = "",y = Percent_from_total,fill = PlotIndex)) +
  geom_bar(width = 1, stat = "identity",color = "black") +
  theme_minimal() +
  theme(legend.position = "right", legend.title = element_text(face = "bold"),
        axis.text.x=element_blank()) +
  coord_polar("y", start = 0) +
  labs(title = "Total tournements per game", y = "From total tournaments", x = element_blank(),
       fill = "Game Title") 

```
<br>
Indeed, tournaments are a little bit less concetrated then earnings.
<br>

Let's take a deeper look at the data - <br>
First, let's look at how the earnings developped through the years.

```{r Earning_timeseries,echo = FALSE}
# Deleating all temporary variables which are now unnecessary
Earnings_by_game <- subset(Earnings_by_game, select = -c(Percent_from_total,PlotIndex))

#Disabling scientific annotation
options(scipen = 100)

# Creating a dataframe
Earning_timeseries <- df %>% select(Earnings,Date,Tournaments) %>% filter(Earnings > 0) %>% group_by(Date) %>% summarise(Earnings_in_millions = round((sum(Earnings)/1000000),1), Tournaments = sum(Tournaments))
Earning_timeseries$Year <- format(Earning_timeseries$Date,"%Y")
Earning_timeseries$Month <- format(Earning_timeseries$Date,"%m")
```


```{r Yearly_earnings}
# Plotting yearly earnings
ggplot(data = Earning_timeseries %>%
         group_by(Year) %>%
         summarise(Earnings_in_millions = sum(Earnings_in_millions)), aes(x = Year, y = Earnings_in_millions)) +
  geom_bar(stat = "Identity", fill = "lightblue") +
  geom_text(aes(label = Earnings_in_millions),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_text(angle=90)) + 
  labs(title = "Earnings by year", subtitle = "In millions of dollars", y = element_blank(),x = element_blank())

ggplot(data = Earning_timeseries %>%
         group_by(Year) %>%
         summarise(Earnings_in_millions = sum(Earnings_in_millions), Tournaments = sum(Tournaments)), aes(x = as.Date(Year, format = "%Y"), y = Tournaments, group = 1)) +
  geom_line(color = "darkred",size = 1, linetype = "longdash") +
  geom_point(color = "darkblue") +
  geom_text(aes(label = Tournaments), vjust = - 1,hjust = 0.55, size = 3) +
  theme(legend.position='none') +
  labs(title = "Tournaments per year", y = element_blank(),x = element_blank()) +
  ylim(0,6000)
```
<br>
__It is important to note that 2020 is not finished and this is why the earnings are low.
We can see that the Esports industry picked up towards 2011 - 2012, reaching a whopping 228.9 miliion dollar in prizes distributed in 2019. <br>
 <br>

Tournament wise, we see that the number of tournaments started to skyrocket in 2011, stabilizing at the 4500 - 5500 range from 2015 onwards. <br> 


Now let's look at the monthly data: is there a specific period with more tournaments and more prize earnings? 
(for these plots I will filter out all datapoints from 2020, as it is not over yet).

```{r Earnings_Per_month}
#Creating a 5 year interval for the dataframe

# Plotting
p1 <- ggplot(data = Earning_timeseries %>% 
         filter(Date < as.Date("2020-01-01")) %>%
         group_by(Month) %>%
         summarise(Earnings_in_millions = sum(Earnings_in_millions)), aes(x = Month, y = Earnings_in_millions)) +
  geom_bar(stat = "identity",fill = "lightblue") +
  theme(legend.position = "bottom") +
  geom_text(aes(label = Earnings_in_millions), vjust = -0.3,hjust = 0.55, size = 3) +
  labs(title = "Esport monthly earnings", subtitle = "In millions of dollars", y = element_blank()) +
  theme_classic() +
  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())

p2 <- ggplot(data = Earning_timeseries %>%
         filter(Date < as.Date("2020-01-01")) %>%
         group_by(Month) %>%
         summarise(Tournaments = sum(Tournaments)), aes(x = Month, y = Tournaments,fill = Month)) +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(legend.position='none') +
  labs(title = "Number of tournaments", y = element_blank())

grid.arrange(p1,p2,ncol = 2)
rm(list = c("p1","p2"))
```

We can see that most of the earnings came from the months of july and august, and as we see that the number of tournements isn't especially higher in these months, it is safe to say that the avarage prizepool is higher in these times (which makes since, as the summer is a peak periode in the Esports industry).

### Did the coronavirus pandemic effect earnings and amount of tournaments?

To check this, ill creat a line plot of months with each line representing a year from 2016 onwards, if the coronavirus had no affect, we should see that 2020 looks to be similar to other years in the matter of tournaments, and higher than other years earning wise.

```{r Coronavirus_effect_earnings}
# Filtering to last 5 years and plotting monthly earnings

ggplot(data = Earning_timeseries %>%
  filter(Date >= as.Date("2016-01-01")), aes(x = Month, y = Earnings_in_millions, group = Year)) +
  geom_line(aes(color = Year), size = 1) +
  theme_minimal() +
  labs(title = "Monthly earnings 2016 - 2020",subtitle = "In millions of dollars",x = element_blank(), y = element_blank())

```
We can see that 2020 did not open well as expected, with weaker earnings from january to june (except for fabruary). <br>
In needs to be said though, that the negative effect of the pandemic is not that significative, I would like to revisit this charte when we will have the complete data for the months of july and august (biggest months, earning wise). <br>

Let's look at the tournament plot now.


```{r Coronavirus_effect_tournaments, echo = FALSE, warning = FALSE}
# Filtering to last 5 years and plotting monthly amount of tournaments

ggplot(data = Earning_timeseries %>%
  filter(Date >= as.Date("2016-01-01")), aes(x = Month, y = Tournaments, group = Year)) +
  geom_line(aes(color = Year), size = 1) +
  theme_minimal() +
  labs(title = "Monthly amount of tournaments 2016 - 2020", x = element_blank(), y = element_blank()) +
  ylim(200,600)

```

Here **there is** a noticable decrease in the amount of tournaments being held.
Again, it would be interesting to see how if this negative trend persists in the rest of 2020. <br>


Let's look at the diffrenet genres <br>

```{r A_look_at_genres}
# Creating the dataframes

# Creating Earnings_by_genre
Earnings_by_genre <- Earnings_by_game %>%
  group_by(Genre) %>%
  summarise(Total_earnings = round(sum(Earnings)/1000000,2),
            Average_earnings = round(mean(Earnings)/1000,2),
            Median_Earnings = round(median(Earnings)/1000,2),
            Number_of_games = n())

# Creating Earnings_by_releasedate
Earnings_by_releasedate <- Earnings_by_game %>%
  group_by(ReleaseDate) %>%
  summarise(Total_earnings = round(sum(Earnings)/1000000,2),
            Average_earnings = round(mean(Earnings)/1000,2),
            Median_Earnings = round(median(Earnings)/1000,2),
            Number_of_games = n())
```


``` {r Total_earnings_per_genre,echo = FALSE}
# Plotting
ggplot(data = Earnings_by_genre,aes(x = Genre,y = Total_earnings, fill = Genre)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Total_earnings),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right") + 
  labs(title = "Total Earnings", subtitle = "In millions of dollars", y = element_blank(), x = element_blank())
```


``` {r Total_games_per_genre,echo = FALSE}
# Plotting
ggplot(data = Earnings_by_genre,aes(x = Genre,y = Number_of_games, fill = Genre)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Number_of_games),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right") + 
  labs(title = "Number of games per genre", y = element_blank(), x = element_blank())

```
 <br><br>
 We can see that there is no real relation between the number of games and the amount of money distributed in Esport tournaments. <br>
 
Now let's look at the release date, do games from a specific year had a biggest impact on the Esports industry?
 
``` {r Avg_earnings_per_releasedate}

# Plotting
ggplot(data = Earnings_by_game,aes(x = ReleaseDate,y = Earnings,fill = Genre)) +
  geom_bar(stat = "identity",col = "Darkgrey") +
  theme_classic() +
  scale_y_continuous(labels = scales::label_number(scale = 1/1000000)) +
  labs(title = "Earnings by release date",subtitle = "In millions of dollars",
    y = element_blank(), x = element_blank()) + 
  ggrepel::geom_text_repel(
    data = subset(Earnings_by_game,Earnings_rank <= 5), aes(label = Game), size = 3.5, box.padding = unit(0.35, "lines"),
    point.padding = unit(0.3, "lines")
  )

```  
<br>
We can see that there is no real correlation between the release date of the game and the success it will have in the Esports scene.<br>
Also, we see that the vast majority of the disribution came from a fraction of the games (for example, almost all of the prize money which was for games in who were released in 2013 came from dota2, the same with 2009 and league of legends).<br>

Now it's time to dive in and do a little bit of feature engineering the retrieve some precius insight.

<center><h2>Feature engineering</h2></center>

In this part i'd like to create new variables which will help in the analysis process.

<h3>Creating **Franchise** variable</h3><br>
As a lot of the games are a part of a franchise containing several games, it may help us if we look at the date looking at the entire franchise, for example, let's take a look at the **Street - Fighter** franchise.<br>

```{r Street_Fighter_look,echo = TRUE}
# Creating a dataframe with games with a name containing the name "Street Fighter"
df_sf <- Earnings_by_game[which(grepl("[Ss]treet [Ff]ighter",Earnings_by_game$Game) == TRUE),]
df_sf
print(paste0("The number_of_games is ",nrow(df_sf)," and the total earnings for the franchise is ",sum(df_sf$Earnings)))

# Removing the df as it is unnecessary
rm(df_sf)

```
<br>
Ok, so the fact that a game is a part of a franchise **_does_** matter. In the case if the "Street Fighter" franchise, there are 15 games with earnings ranging from 350 to 220,000 dollars.<br>
It is fair to say that the entire franchise had destruted prizes in an amount of almost 560,000 dollars.<br>

To figure out which games are a part of which franchise, ill work with the __Earnings_per_game__ dataframe (as it has 1 observation per game, it is easier to work with) and use some regular expressions to find game titles which have identical words in it.

```{r franchise_search_5_words, warning = FALSE}

# At the start ill cast a large net, finding the first 5 words of each game.
# then filtering to find groups of 2 or more games with the same 5 first words in the title.

temp_5_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",Earnings_by_game$Game)
# Creating a dataframe to recieve the matches
temp_5_words <- data.frame(words = regmatches(Earnings_by_game$Game,temp_5_words))
temp_5_words <-  temp_5_words %>% group_by(words) %>% summarise(n=n())
# Filtering and presnting
temp_5_words <- temp_5_words %>% filter(n >1)
temp_5_words

# We already indentified a few franchises, ill put them in a new variable - "Franchise".

Earnings_by_game[which(grepl("Call of Duty",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Call of Duty"
Earnings_by_game[which(grepl("Guilty Gear",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Guilty Gear"
Earnings_by_game[which(grepl("Street Fighter",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Street Fighter"

# Removing the dataframe unnecessary 
rm(temp_5_words)
```
<br>

Now we move into the 4 words category, but at first we will need to filter out the games with a valid francise variable, ill put all the games that are left in another temporary dataframe - **Franchise_check**. <br>

I'll continue the same process for expressions that inclue 4, 3, 2 and then one word (ill not present it to not clutter too much).

```{r franchise_search_4_words, warning = FALSE, include = FALSE}

Franchise_check <- Earnings_by_game %>% filter(is.na(Franchise))
temp_4_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_4_words <- data.frame(words = regmatches(Franchise_check$Game,temp_4_words))
temp_4_words <- temp_4_words %>% group_by(words) %>% summarise(n=n())
temp_4_words <- temp_4_words %>% filter(n >1)
temp_4_words

# Continuing on and inserting more franchises.

Earnings_by_game[which(grepl("Dead or Alive",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Dead or Alive"
Earnings_by_game[which(grepl("Dengeki Bunko",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Dengeki Bunko"
Earnings_by_game[which(grepl("Melty Blood",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Melty Blood"
Earnings_by_game[which(grepl("Need for Speed",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Need for Speed"
Earnings_by_game[which(grepl("Under Night In-Birth",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Under Night In-Birth"

# Removing the dataframe unnecessary 
rm(temp_4_words)
```


```{r franchise_search_3_words, include = FALSE}

Franchise_check <- Earnings_by_game %>% filter(is.na(Franchise))
temp_3_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_3_words <- data.frame(words = regmatches(Franchise_check$Game,temp_3_words))
temp_3_words <- temp_3_words %>% group_by(words) %>% summarise(n=n())
temp_3_words <- temp_3_words %>% filter(n >1)
temp_3_words

# Continuing on and inserting more franchises.

Earnings_by_game[which(grepl("Age of Empires",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Age of Empires"
Earnings_by_game[which(grepl("Arcana Heart",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Arcana Heart"
Earnings_by_game[which(grepl("BlazBlue",Earnings_by_game$Game) == TRUE),"Franchise"] <- "BlazBlue"
Earnings_by_game[which(grepl("Capcom vs. SNK",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Capcom vs. SNK"
Earnings_by_game[which(grepl("Gears of War",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Gears of War"
Earnings_by_game[which(grepl("King of Fighters",Earnings_by_game$Game) == TRUE),"Franchise"] <- "King of Fighters"
Earnings_by_game[which(grepl("Magic: The Gathering",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Magic: The Gathering"
Earnings_by_game[which(grepl("Marvel vs. Capcom",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Marvel vs. Capcom"
Earnings_by_game[which(grepl("Persona",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Persona"
Earnings_by_game[which(grepl("Pro Evolution Soccer",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Pro Evolution Soccer"
Earnings_by_game[which(grepl("Project Gotham Racing",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Project Gotham Racing"
Earnings_by_game[which(grepl("Rainbow Six",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Rainbow Six"
Earnings_by_game[which(grepl("Soul Calibur",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Soul Calibur"
Earnings_by_game[which(grepl("Super Smash Bros",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Super Smash Bros"
Earnings_by_game[which(grepl("Tekken ",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Tekken" #Left the space on purpose
Earnings_by_game[which(grepl("Virtua Fighter",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Virtua Fighter"
Earnings_by_game[which(grepl("World of Tanks",Earnings_by_game$Game) == TRUE),"Franchise"] <- "World of Tanks"

# Removing the dataframe unnecessary 
rm(temp_3_words)
```

```{r franchise_search_2_words, include = FALSE}

Franchise_check <- Earnings_by_game %>% filter(is.na(Franchise))
temp_2_words <- regexpr("^[[:graph:]]+\\s{1}[[:graph:]]+",Franchise_check$Game)
temp_2_words <- data.frame(words = regmatches(Franchise_check$Game,temp_2_words))
temp_2_words <- temp_2_words %>% group_by(words) %>% summarise(n=n())
temp_2_words <- temp_2_words %>% filter(n >1)
temp_2_words

# Continuing on and inserting more franchises.

Earnings_by_game[which(grepl("Day of Defeat",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Day of Defeat"
Earnings_by_game[which(grepl("Dragon Ball",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Dragon Ball"
Earnings_by_game[which(grepl("FIFA Online",Earnings_by_game$Game) == TRUE),"Franchise"] <- "FIFA Online"
Earnings_by_game[which(grepl("Forza Motorsport",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Forza"
Earnings_by_game[which(grepl("Gran Turismo",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Gran Turismo"
Earnings_by_game[which(grepl("Guitar Hero",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Guitar Hero"
Earnings_by_game[which(grepl("Halo",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Halo"
Earnings_by_game[which(grepl("Madden NFL",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Madden NFL"
Earnings_by_game[which(grepl("Mortal Kombat",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Mortal Kombat"
Earnings_by_game[which(grepl("NASCAR Thunder",Earnings_by_game$Game) == TRUE),"Franchise"] <- "NASCAR Thunder"
Earnings_by_game[which(grepl("Pokkén Tournament",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Pokkén Tournament"
Earnings_by_game[which(grepl("Project Cars",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Project Cars"
Earnings_by_game[which(grepl("Samurai Shodown",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Samurai Shodown"
Earnings_by_game[which(grepl("Track[Mm]ania",Earnings_by_game$Game) == TRUE),"Franchise"] <- "TrackMania"
Earnings_by_game[which(grepl("Unreal Tournament",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Unreal Tournament"

# Removing the dataframe unnecessary 
rm(temp_2_words)
```

```{r franchise_search_1_word, include = FALSE}

Franchise_check <- Earnings_by_game %>% filter(is.na(Franchise))
temp_1_word <- regexpr("^[[:graph:]]+",Franchise_check$Game)
temp_1_word <- data.frame(words = regmatches(Franchise_check$Game,temp_1_word))
temp_1_word <- temp_1_word %>% group_by(words) %>% summarise(n=n())
temp_1_word <- temp_1_word %>% filter(n >1)
temp_1_word

# Continuing on and inserting more franchises.

Earnings_by_game[which(grepl("Artifact",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Artifact"
Earnings_by_game[which(grepl("Asphalt ",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Asphalt" # Space is on purpose
Earnings_by_game[which(grepl("Battlefield",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Battlefield"
Earnings_by_game[which(grepl("Counter-Strike",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Counter-Strike"
Earnings_by_game[which(grepl("Doom",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Doom"
Earnings_by_game[which(grepl("Dota 2|Defense of the Ancients",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Dota"
Earnings_by_game[which(grepl("F1",Earnings_by_game$Game) == TRUE),"Franchise"] <- "F1"
Earnings_by_game[which(grepl("FIFA (?!Online)",Earnings_by_game$Game,perl = TRUE) == TRUE),"Franchise"] <- "FIFA" # As Fifa and Fifa online are different
Earnings_by_game[which(grepl("NHL",Earnings_by_game$Game) == TRUE),"Franchise"] <- "NHL"
Earnings_by_game[which(grepl("Power Rangers",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Power Rangers"
Earnings_by_game[which(grepl("Quake",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Quake"
Earnings_by_game[which(grepl("Skullgirls",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Skullgirls"
Earnings_by_game[which(grepl("Splatoon",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Splatoon"
Earnings_by_game[which(grepl("Supreme Commander",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Supreme Commander"
Earnings_by_game[which(grepl("Tetris",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Tetris"
Earnings_by_game[which(grepl("^WarCraft",Earnings_by_game$Game) == TRUE),"Franchise"] <- "WarCraft"

# Removing the dataframe unnecessary 
rm(temp_1_word)
```

```{r Last_franchise_check,include = FALSE}
Franchise_check <- Earnings_by_game %>% filter(is.na(Franchise))

Earnings_by_game[which(grepl("^Gears ",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Gears of War"
Earnings_by_game[which(grepl("^Catherine",Earnings_by_game$Game) == TRUE),"Franchise"] <- "Catherine"
Earnings_by_game[which(grepl("(?<!Auto )[Cc]hess",Earnings_by_game$Game,perl = TRUE) == TRUE),"Franchise"] <- "Chess" #Avoiding Auto Chess
Earnings_by_game[which(grepl("Injustice",Earnings_by_game$Game,perl = TRUE) == TRUE),"Franchise"] <- "Injustice"
Earnings_by_game[which(grepl("PLAYERUNKNOWN",Earnings_by_game$Game,perl = TRUE) == TRUE),"Franchise"] <- "PUBG"
Earnings_by_game[which(grepl("StarCraft",Earnings_by_game$Game,perl = TRUE) == TRUE),"Franchise"] <- "StarCraft"

```

```{r franchise_for_standalone_games, echo = TRUE}
# For the rest of the games which are not part of a franchise ill insert their title as a franchise.
##### A note #######
# It is important that once the database will be updated with more games this process will need to be redone.
####################
for (i in seq(1:nrow(Earnings_by_game)))
  {
  if (is.na(Earnings_by_game[i,"Franchise"]))
    {
    Earnings_by_game[i,"Franchise"] <- Earnings_by_game[i,"Game"]
    Earnings_by_game[i,"Stand_alone?"] <- 1
  }
}

sum(is.na(Earnings_by_game$Franchise))
# All done!

# Deleating the df
rm(Franchise_check)
```

Now let's do some analysis about different franchises in the Esports scene. <br>

First, let's see which if after itroducing franchises, the list of top 10 in distribution of prize money change.

```{r top10_franchise, echo = FALSE}
# Creating df that groups by franchises
Earnings_by_franchise <- Earnings_by_game %>% 
  select(Earnings,Genre,Tournaments,Franchise) %>% 
  group_by(Franchise,Genre) %>% 
  summarise(Size = n(),Tournaments = sum(Tournaments),Earnings = sum(Earnings))

# Ordering and keeping the 10 biggest franchises
Earnings_by_franchise[order(Earnings_by_franchise$Earnings,decreasing = TRUE),][1:10,]
```

<br>
As there are no real differences between the list of top10 games and top10 franchises (except for the Call of Duty franchise in 6th place with 15 games in the franchise), now lets see how the list of top 10 largest amount of tournaments changes after intoducing franchises.


```{r Largest_amount_of_tournaments}
# Ordering and keeping the 10 biggest franchises
Earnings_by_franchise[order(Earnings_by_franchise$Tournaments,decreasing = TRUE),][1:10,c(1,3,4,5)]
```
<br>
Also in the matter of the amount of tournaments, except the Call of Duty and WarCraft franchises, the list stays about the same.


``` {r Total_franchises_per_genre}
# Creating another df, this time for the plot

Franchise_by_genre <- Earnings_by_franchise %>% 
  group_by(Genre) %>%
  summarise(Number_of_franchises = n(),Tournaments = sum(Tournaments),Earnings = sum(Earnings),Number_of_games = sum(Size),Avg_games_per_franchise = round( (sum(Size)/n()),2))

# Plotting

ggplot(data = Franchise_by_genre,aes(x = Genre,y = Number_of_franchises, fill = Genre)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Number_of_franchises),
            vjust = -0.3,hjust = 0.55, size = 3.5) +
  theme_classic() +
  theme(axis.text= element_blank(), axis.ticks = element_blank(), legend.position = "right") + 
  labs(title = "Number of franchises per genre", y = element_blank(), x = element_blank())

```

<br>






<center><h2>This is a work in progress, there is more to come</h2></center>
<center><h3>Feel free to upvote or to give feedback :)</h3></center>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  